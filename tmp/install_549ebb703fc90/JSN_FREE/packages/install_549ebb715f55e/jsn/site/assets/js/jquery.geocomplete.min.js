(function(f,e,a,h){var g={bounds:true,country:null,map:false,details:false,detailsAttribute:"name",location:false,onlyPac:false,addReset:false,addPosition:false,wrap:true,mapOptions:{zoom:14,scrollwheel:false,mapTypeId:"roadmap"},markerOptions:{draggable:false},maxZoom:16,types:["geocode"]};var b=("street_address route intersection political country administrative_area_level_1 administrative_area_level_2 administrative_area_level_3 colloquial_area locality sublocality neighborhood premise subpremise postal_code natural_feature airport park point_of_interest post_box street_number floor room lat lng viewport location formatted_address location_type bounds").split(" ");var d=("id url website vicinity reference name rating international_phone_number icon formatted_phone_number").split(" ");function c(j,k){this.options=f.extend(true,{},g,k);this.input=j;this.$input=f(j);this._defaults=g;this._name="geocomplete";var l=this.options.details;var n=this.options.detailsAttribute;var m=this.options.map;if(f(l+" ["+n+"='formatted_address']").length==0){this.$input.after('<input type="hidden" '+n+'="formatted_address" />')}this.$input.blur(function(){setTimeout(function(){j.value=f(l+" ["+n+"='formatted_address']").val();f(j).change()},10)});this.init();if(this.options.onlyPac){google.maps.event.addDomListener(j,"keydown",function(q){if(q.keyCode==13){var p=f(".pac-item").length>0;if(p){var o=f(".pac-item.pac-selected").length>0;if(q.keyCode==13&&!o){google.maps.event.trigger(j,"keydown",{keyCode:40,which:40})}}else{setTimeout(function(){j.value=f(l+" ["+n+"='formatted_address']").val()},10)}}})}if((this.options.addReset||this.options.addPosition)&&this.options.wrap){this.$input.wrap('<div class="input-prepend" />')}if(this.options.addPosition){var i=navigator.geolocation!==h;if(i){this.$input.before('<a class="btn btn-success" id="'+n+'-geolocation"><i class="icon-location icon-map-marker"></i></a>');f("#"+n+"-geolocation").click(function(){navigator.geolocation.getCurrentPosition(function(o){f(j).geocomplete("geocode",{address:o.coords.latitude+","+o.coords.longitude})});return false})}}if(this.options.addReset){this.$input.before('<a class="btn btn-danger" id="'+n+'-reset"><i class="icon-remove"></i></a>');f("#"+n+"-reset").click(function(){f(l+" ["+n+"='formatted_address']").val("");j.value="";f(m).hide();return false})}f(m).hide()}f.extend(c.prototype,{init:function(){this.initMap();this.initMarker();this.initGeocoder();this.initDetails();this.initLocation()},initMap:function(){if(!this.options.map){return}if(typeof this.options.map.setCenter=="function"){this.map=this.options.map;return}this.map=new google.maps.Map(f(this.options.map)[0],this.options.mapOptions)},initMarker:function(){if(!this.map){return}var i=f.extend(this.options.markerOptions,{map:this.map});if(i.disabled){return}this.marker=new google.maps.Marker(i);google.maps.event.addListener(this.marker,"dragend",f.proxy(this.markerDragged,this))},initGeocoder:function(){var i={types:this.options.types,bounds:this.options.bounds===true?null:this.options.bounds,componentRestrictions:this.options.componentRestrictions};if(this.options.country){i.componentRestrictions={country:this.options.country}}this.autocomplete=new google.maps.places.Autocomplete(this.input,i);this.geocoder=new google.maps.Geocoder();if(this.map&&this.options.bounds===true){this.autocomplete.bindTo("bounds",this.map)}google.maps.event.addListener(this.autocomplete,"place_changed",f.proxy(this.placeChanged,this));this.$input.keypress(function(j){if(j.keyCode===13){return false}});this.$input.bind("geocode",f.proxy(function(){this.find()},this))},initDetails:function(){if(!this.options.details){return}var i=f(this.options.details),l=this.options.detailsAttribute,j={};function k(m){j[m]=i.find("["+l+"="+m+"]")}f.each(b,function(m,n){k(n);k(n+"_short")});f.each(d,function(m,n){k(n)});this.$details=i;this.details=j},initLocation:function(){var i=this.options.location,j;if(!i){return}if(typeof i=="string"){this.find(i);return}if(i instanceof Array){j=new google.maps.LatLng(i[0],i[1])}if(i instanceof google.maps.LatLng){j=i}if(j){if(this.map){this.map.setCenter(j)}}},find:function(i){if(!this.options.onlyPac){this.geocode({address:i||this.$input.val()})}},geocode:function(i){if(this.options.bounds&&!i.bounds){if(this.options.bounds===true){i.bounds=this.map&&this.map.getBounds()}else{i.bounds=this.options.bounds}}if(this.options.country){i.region=this.options.country}this.geocoder.geocode(i,f.proxy(this.handleGeocode,this))},handleGeocode:function(k,j){if(j===google.maps.GeocoderStatus.OK){var i=k[0];this.$input.val(i.formatted_address);this.update(i);if(k.length>1){this.trigger("geocode:multiple",k)}}else{this.trigger("geocode:error",j)}},trigger:function(j,i){this.$input.trigger(j,[i])},center:function(i){if(i.viewport){this.map.fitBounds(i.viewport);if(this.map.getZoom()>this.options.maxZoom){this.map.setZoom(this.options.maxZoom)}}else{this.map.setZoom(this.options.maxZoom);this.map.setCenter(i.location)}if(this.marker){this.marker.setPosition(i.location);this.marker.setAnimation(this.options.markerOptions.animation)}},update:function(i){if(this.map){f(this.options.map).show();this.initMap();this.initMarker();this.center(i.geometry)}if(this.$details){this.fillDetails(i)}this.trigger("geocode:result",i)},fillDetails:function(j){var l={},m=j.geometry,i=m.viewport,k=m.bounds;f.each(j.address_components,function(p,o){var n=o.types[0];l[n]=o.long_name;l[n+"_short"]=o.short_name});f.each(d,function(n,o){l[o]=j[o]});f.extend(l,{formatted_address:j.formatted_address,location_type:m.location_type||"PLACES",viewport:i,bounds:k,location:m.location,lat:m.location.lat(),lng:m.location.lng()});f.each(this.details,f.proxy(function(n,p){var o=l[n];this.setDetail(p,o)},this));this.data=l},setDetail:function(i,j){if(j===h){j=""}else{if(typeof j.toUrlValue=="function"){j=j.toUrlValue()}}if(i.is(":input")){i.val(j)}else{i.text(j)}},markerDragged:function(i){this.trigger("geocode:dragged",i.latLng);this.geocode({address:i.latLng.toString()})},resetMarker:function(){this.marker.setPosition(this.data.location);this.setDetail(this.details.lat,this.data.location.lat());this.setDetail(this.details.lng,this.data.location.lng())},placeChanged:function(){var i=this.autocomplete.getPlace();if(!i.geometry){this.find(i.name)}else{this.update(i)}}});f.fn.geocomplete=function(j){var k="plugin_geocomplete";if(typeof j=="string"){var i=f(this).data(k)||f(this).geocomplete().data(k),l=i[j];if(typeof l=="function"){l.apply(i,Array.prototype.slice.call(arguments,1));return f(this)}else{if(arguments.length==2){l=arguments[1]}return l}}else{return this.each(function(){var m=f.data(this,k);if(!m){m=new c(this,j);f.data(this,k,m)}})}}})(jQuery,window,document);